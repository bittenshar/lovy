{
  "title": "Firebase FCM Notification - Complete Master Guide",
  "version": "2.0",
  "createdAt": "2025-12-09",
  "status": "READY TO TEST",
  "projectInfo": {
    "firebaseProject": "workconnect2-1313",
    "backend": "http://localhost:3000",
    "database": "MongoDB",
    "authentication": "JWT Bearer Token"
  },
  "SECTION_1_QUICK_START": {
    "fillInYourDetails": {
      "fcmToken": "PASTE_YOUR_FCM_TOKEN_HERE",
      "jwtToken": "PASTE_YOUR_JWT_TOKEN_HERE",
      "userId": "PASTE_YOUR_USER_ID_HERE"
    },
    "step1_get_tokens": "Open Flutter app, login, check console for FCM Token message",
    "step2_get_jwt": "JWT token returned in login response (starts with eyJ)",
    "step3_copy_tokens": "Fill in the 3 fields above with your actual tokens",
    "step4_send_test": "Use curl from SECTION_3 or shell script to test"
  },
  "SECTION_2_API_ENDPOINTS": {
    "health_check": {
      "method": "GET",
      "url": "http://localhost:3000/api/notifications/health",
      "auth_required": false
    },
    "send_to_single_device": {
      "method": "POST",
      "url": "http://localhost:3000/api/notifications/send",
      "auth_required": false,
      "body": {
        "fcmToken": "YOUR_FCM_TOKEN",
        "title": "Hello from Backend",
        "body": "Test notification",
        "data": {"screen": "jobs"}
      }
    },
    "send_batch_notification": {
      "method": "POST",
      "url": "http://localhost:3000/api/notifications/send-batch",
      "auth_required": false,
      "body": {
        "fcmTokens": ["TOKEN_1", "TOKEN_2"],
        "title": "Batch Message",
        "body": "Sent to multiple devices"
      }
    },
    "register_token": {
      "method": "POST",
      "url": "http://localhost:3000/api/notifications/register-token",
      "auth_required": true,
      "body": {
        "fcmToken": "YOUR_FCM_TOKEN",
        "platform": "android"
      }
    },
    "get_user_tokens": {
      "method": "GET",
      "url": "http://localhost:3000/api/notifications/tokens",
      "auth_required": true
    },
    "send_test_notification": {
      "method": "POST",
      "url": "http://localhost:3000/api/notifications/test",
      "auth_required": true,
      "body": {
        "userId": "YOUR_USER_ID",
        "title": "Test",
        "body": "Testing FCM"
      }
    },
    "send_to_topic": {
      "method": "POST",
      "url": "http://localhost:3000/api/notifications/send-to-topic",
      "auth_required": true,
      "body": {
        "topic": "announcements",
        "title": "Topic Message",
        "body": "Sent to all subscribers"
      }
    },
    "subscribe_to_topic": {
      "method": "POST",
      "url": "http://localhost:3000/api/notifications/subscribe",
      "auth_required": true,
      "body": {
        "fcmToken": "YOUR_FCM_TOKEN",
        "topic": "announcements"
      }
    },
    "unsubscribe_from_topic": {
      "method": "POST",
      "url": "http://localhost:3000/api/notifications/unsubscribe",
      "auth_required": true,
      "body": {
        "fcmToken": "YOUR_FCM_TOKEN",
        "topic": "announcements"
      }
    }
  },
  "SECTION_3_CURL_COMMANDS": {
    "send_to_device": "curl -X POST http://localhost:3000/api/notifications/send -H 'Content-Type: application/json' -H 'Authorization: Bearer YOUR_JWT_TOKEN' -d '{\"fcmToken\":\"YOUR_FCM_TOKEN\",\"title\":\"Hello\",\"body\":\"Test notification\",\"data\":{\"screen\":\"jobs\"}}'",
    "send_batch": "curl -X POST http://localhost:3000/api/notifications/send-batch -H 'Content-Type: application/json' -H 'Authorization: Bearer YOUR_JWT_TOKEN' -d '{\"fcmTokens\":[\"TOKEN_1\",\"TOKEN_2\"],\"title\":\"Batch\",\"body\":\"Message\"}'",
    "register_token": "curl -X POST http://localhost:3000/api/notifications/register-token -H 'Content-Type: application/json' -H 'Authorization: Bearer YOUR_JWT_TOKEN' -d '{\"fcmToken\":\"YOUR_FCM_TOKEN\",\"platform\":\"android\"}'",
    "test_notification": "curl -X POST http://localhost:3000/api/notifications/test -H 'Content-Type: application/json' -H 'Authorization: Bearer YOUR_JWT_TOKEN' -d '{\"userId\":\"YOUR_USER_ID\",\"title\":\"Test\",\"body\":\"Testing\"}'",
    "health_check": "curl -X GET http://localhost:3000/api/notifications/health"
  },
  "SECTION_4_NOTIFICATION_TEMPLATES": {
    "job_notification": {
      "title": "New Job Available",
      "body": "Software Developer - $50/hr - New York",
      "data": {"screen": "jobs", "jobId": "123", "action": "open_job"}
    },
    "application_notification": {
      "title": "New Application",
      "body": "John Smith applied to your JavaScript Developer job",
      "data": {"screen": "applications", "applicationId": "456"}
    },
    "attendance_notification": {
      "title": "Attendance Alert",
      "body": "Employee clocked in at 9:00 AM",
      "data": {"screen": "attendance", "employeeId": "789"}
    },
    "broadcast_notification": {
      "title": "Platform Update",
      "body": "New features are now available",
      "data": {"screen": "home", "action": "show_announcement"}
    },
    "message_notification": {
      "title": "New Message",
      "body": "New message from John: Hello",
      "data": {"screen": "messages", "conversationId": "101"}
    }
  },
  "SECTION_5_FIELDS_EXPLAINED": {
    "fcmToken": {
      "type": "string",
      "required": true,
      "description": "Firebase Cloud Messaging token from device (150+ characters)"
    },
    "title": {
      "type": "string",
      "required": true,
      "description": "Notification title (max 65 chars)",
      "example": "New Job Posted"
    },
    "body": {
      "type": "string",
      "required": true,
      "description": "Notification message (max 240 chars)"
    },
    "data": {
      "type": "object",
      "required": false,
      "description": "Custom data object (all values must be strings)"
    }
  },
  "SECTION_6_TROUBLESHOOTING": {
    "notification_not_arriving": {
      "causes": ["Wrong Firebase project", "Invalid service account", "Incorrect google-services.json"],
      "solutions": ["Verify project ID: workconnect2-1313", "Check firebase-service-account.json", "Restart app: flutter clean && flutter run"]
    },
    "401_unauthorized": {
      "cause": "JWT token invalid or expired",
      "solution": "Login again to get new JWT token"
    },
    "400_bad_request": {
      "causes": ["FCM token too short", "Missing title or body", "Title/body too long"],
      "solution": "Verify all required fields match format in SECTION_5"
    },
    "500_server_error": {
      "causes": ["Firebase Admin SDK not initialized", "Invalid credentials", "Backend not running"],
      "solution": "Check backend logs: npm start"
    }
  },
  "SECTION_7_HOW_TO_GET_TOKENS": {
    "fcmToken": {
      "source": "Flutter app console logs after login",
      "format": "150+ characters, starts with 'c', contains ':' and '_'",
      "example": "cZmNlYH_Qw-zgXvn08Z0Bb:APA91bG7TRNdzEBklaxrMqWDXVD2..."
    },
    "jwtToken": {
      "source": "Login response (POST /api/auth/login)",
      "format": "Starts with 'eyJ', contains 2 dots",
      "example": "eyJhbGc.eyJpZC.signature"
    },
    "userId": {
      "source": "User profile or decoded JWT token",
      "format": "MongoDB ObjectId like 507f1f77bcf86cd799439011"
    }
  },
  "SECTION_8_COMPLETE_TESTING_WORKFLOW": {
    "step1": "Start backend: npm start (should show 'Server listening on port 3000')",
    "step2": "Run Flutter app: flutter run",
    "step3": "Login to app with your credentials",
    "step4": "Check app console for FCM Token message, copy it",
    "step5": "Copy JWT token from login response",
    "step6": "Fill in SECTION_1 with your fcmToken and jwtToken",
    "step7": "Send test: copy curl from SECTION_3 and run in terminal",
    "step8": "Check your device for notification - success if it appears!"
  },
  "SECTION_9_QUICK_REFERENCE": {
    "backend_url": "http://localhost:3000",
    "firebase_project": "workconnect2-1313",
    "main_endpoint": "POST /api/notifications/send",
    "required_headers": {
      "Content-Type": "application/json",
      "Authorization": "Bearer YOUR_JWT_TOKEN"
    },
    "minimum_payload": {
      "fcmToken": "YOUR_FCM_TOKEN",
      "title": "Title",
      "body": "Message body"
    },
    "backend_logs": "npm start | grep -i 'fcm\\|firebase\\|notification'",
    "files_needed": ["FCM-MASTER-GUIDE.json", "send-notification.sh", "Firebase-FCM-Notifications.postman_collection.json"]
  }
}
