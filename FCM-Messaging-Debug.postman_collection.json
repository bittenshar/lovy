{
  "info": {
    "name": "FCM Messaging Debug Tests",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "1Ô∏è‚É£ Get Conversations",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{AUTH_TOKEN}}",
            "type": "text"
          },
          {
            "key": "Content-Type",
            "value": "application/json",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{BASE_URL}}/api/conversations",
          "host": [
            "{{BASE_URL}}"
          ],
          "path": [
            "api",
            "conversations"
          ]
        },
        "description": "Get all conversations for current user\n\nüî¥ [DEBUG-FLUTTER] logs should show auth token and response status"
      },
      "response": []
    },
    {
      "name": "2Ô∏è‚É£ Create Conversation",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{AUTH_TOKEN}}",
            "type": "text"
          },
          {
            "key": "Content-Type",
            "value": "application/json",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"participants\": [\"{{RECIPIENT_USER_ID}}\"]\n}"
        },
        "url": {
          "raw": "{{BASE_URL}}/api/conversations",
          "host": [
            "{{BASE_URL}}"
          ],
          "path": [
            "api",
            "conversations"
          ]
        },
        "description": "Create a new conversation with a recipient\n\nüìù [CONV] Creating conversation logs\nüî¥ [DEBUG-FCM] Should show conversation started notification being sent\n\nSet variables:\n- RECIPIENT_USER_ID: The ID of the other user"
      },
      "response": []
    },
    {
      "name": "3Ô∏è‚É£ Get Messages in Conversation",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{AUTH_TOKEN}}",
            "type": "text"
          },
          {
            "key": "Content-Type",
            "value": "application/json",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{BASE_URL}}/api/conversations/{{CONVERSATION_ID}}/messages",
          "host": [
            "{{BASE_URL}}"
          ],
          "path": [
            "api",
            "conversations",
            "{{CONVERSATION_ID}}",
            "messages"
          ]
        },
        "description": "Get all messages in a conversation\n\nüì¨ [MSG] GET /conversations/:id/messages logs\n\nSet variables:\n- CONVERSATION_ID: From the create conversation response"
      },
      "response": []
    },
    {
      "name": "4Ô∏è‚É£ Send Message (FCM TEST) üî¥",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{AUTH_TOKEN}}",
            "type": "text"
          },
          {
            "key": "Content-Type",
            "value": "application/json",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"body\": \"Test message from FCM debug - Check logs for üî¥ [DEBUG-FCM]\"\n}"
        },
        "url": {
          "raw": "{{BASE_URL}}/api/conversations/{{CONVERSATION_ID}}/messages",
          "host": [
            "{{BASE_URL}}"
          ],
          "path": [
            "api",
            "conversations",
            "{{CONVERSATION_ID}}",
            "messages"
          ]
        },
        "description": "Send a message - THIS TRIGGERS FCM NOTIFICATIONS ‚ö°\n\nüî¥ DEBUG OUTPUT TO WATCH FOR:\n\n1. Backend conversation.controller.js:\n   üì® [MSG] ===== SEND MESSAGE START =====\n   ‚úÖ [MSG] Message created successfully\n   üî¥ [DEBUG-FCM] ===== FCM NOTIFICATION START =====\n   üî¥ [DEBUG-FCM] Recipient ID: <id>\n   üî¥ [DEBUG-FCM] FCM Result: { success: true, sent: 1 }\n   ‚úÖ [DEBUG-FCM] FCM notification sent successfully\n\n2. notification.utils.js:\n   üî¥ [DEBUG-TEMPLATE] sendTemplatedNotification START\n   üî¥ [DEBUG-UTIL] ===== sendToUser START =====\n   üî¥ [DEBUG-UTIL] Firebase Initialized: true ‚Üê CRITICAL\n   üî¥ [DEBUG-UTIL] Found X FCM tokens\n   üî¥ [DEBUG-UTIL] Calling admin.messaging().send()...\n   ‚úÖ [DEBUG-UTIL] FCM send successful\n   üî¥ [DEBUG-UTIL] FCM Batch Summary:\n     - Total tokens: X\n     - Successfully sent: X\n     - Failed: 0\n\n3. If FCM fails:\n   ‚ùå [DEBUG-UTIL] FCM error code: <error_code>\n   üî¥ [DEBUG-UTIL] FCM error message: <error_message>\n\nSet variables:\n- CONVERSATION_ID: From previous requests"
      },
      "response": []
    },
    {
      "name": "5Ô∏è‚É£ Mark Conversation as Read",
      "request": {
        "method": "PATCH",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{AUTH_TOKEN}}",
            "type": "text"
          },
          {
            "key": "Content-Type",
            "value": "application/json",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{}"
        },
        "url": {
          "raw": "{{BASE_URL}}/api/conversations/{{CONVERSATION_ID}}/read",
          "host": [
            "{{BASE_URL}}"
          ],
          "path": [
            "api",
            "conversations",
            "{{CONVERSATION_ID}}",
            "read"
          ]
        },
        "description": "Mark conversation messages as read\n\nüëÅÔ∏è [CONV] Marking conversation as read logs"
      },
      "response": []
    }
  ],
  "variable": [
    {
      "key": "BASE_URL",
      "value": "http://localhost:5000",
      "type": "string"
    },
    {
      "key": "AUTH_TOKEN",
      "value": "your_jwt_token_here",
      "type": "string"
    },
    {
      "key": "CONVERSATION_ID",
      "value": "conversation_id_from_response",
      "type": "string"
    },
    {
      "key": "RECIPIENT_USER_ID",
      "value": "another_users_id",
      "type": "string"
    }
  ]
}
